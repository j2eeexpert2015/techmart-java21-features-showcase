<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java 21 Pattern Matching Demo</title>
    <style>
        /* ================================
           CSS STYLES - CLEAN LAYOUT
           ================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .page-wrapper {
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 40px);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: transparent;
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            color: #667eea;
        }

        /* Main Container */
        .container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
            align-items: flex-start;
            flex: 1;
        }

        /* Left Side */
        .left-side {
            flex: 2;
            background: transparent;
        }

        /* Right Side - FIXED LAYOUT */
        .right-side {
            flex: 1;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: fit-content;
            max-height: calc(100vh - 140px);
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border: 1px solid #e5e7eb;
        }

        .card h3 {
            margin-bottom: 10px;
            font-size: 16px;
            color: #333;
        }

        /* Top Row Layout */
        .top-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .step1-card {
            flex: 1;
        }

        .instructions-card {
            flex: 1;
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f9ff 100%);
            border: 1px solid #3b82f6;
        }

        .instructions-card h3 {
            color: #1e40af;
            font-size: 14px;
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            gap: 8px;
        }

        .payment-card {
            flex: 1;
            border: 2px solid #e5e7eb;
            padding: 8px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
            position: relative;
        }

        .payment-card.selected {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .payment-card.selected::after {
            content: '✓';
            position: absolute;
            top: 5px;
            right: 8px;
            background: #10b981;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            animation: checkmarkPop 0.3s ease-out;
        }

        @keyframes checkmarkPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .payment-card h4 {
            font-size: 12px;
            margin-bottom: 2px;
        }

        .payment-card p {
            font-size: 10px;
            color: #666;
            margin: 0;
        }

        /* Instructions Grid */
        .instructions-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            font-size: 11px;
        }

        .instruction-item {
            background: white;
            padding: 6px;
            border-radius: 4px;
            border-left: 2px solid #3b82f6;
        }

        .step-num {
            background: #3b82f6;
            color: white;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            margin-right: 5px;
        }

        /* Amount Buttons */
        .amount-section {
            background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
            border: 1px solid #e0e7ff;
        }

        .amount-buttons {
            display: flex;
            gap: 8px;
        }

        .amount-btn {
            flex: 1;
            padding: 8px;
            border: 1px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .amount-btn:hover {
            background: #667eea;
            color: white;
        }

        .amount-btn small {
            display: block;
            font-size: 9px;
            margin-top: 2px;
        }

        /* Process Button */
        .process-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .process-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s ease;
        }

        .process-btn:hover::before {
            left: 100%;
        }

        .process-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        /* Result */
        .result-card {
            background: linear-gradient(135deg, #f0f9f0 0%, #e8f5e8 100%);
            border: 1px solid #c3e6cb;
            display: none;
            border-left: 4px solid #10b981;
            animation: resultSlideIn 0.5s ease-out;
        }

        @keyframes resultSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Right Side Content */
        .features-section h3 {
            color: #fbbf24;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
            border-left: 2px solid #fbbf24;
        }

        .feature-item strong {
            display: block;
            color: #f3f4f6;
            font-size: 11px;
            margin-bottom: 3px;
        }

        .feature-item code {
            color: #34d399;
            font-family: monospace;
            font-size: 10px;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 4px;
            border-radius: 2px;
        }

        /* FIXED LOG SECTION - Like Shopping Cart */
        .log-section {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: #f1f5f9;
            font-family: 'JetBrains Mono', 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 11px;
            height: 300px;
            overflow-y: auto;
            margin-top: 15px;
            border: 2px solid #475569;
            position: relative;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            padding: 10px;
        }

        .log-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #10b981, #06b6d4, #f59e0b);
            border-radius: 8px 8px 0 0;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .log-header h3 {
            color: #34d399;
            font-size: 12px;
            margin: 0;
        }

        .clear-btn {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
        }

        /* ENHANCED API FLOW BLOCKS - Like Shopping Cart */
        .api-flow-block {
            margin-bottom: 8px;
            padding: 8px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.04) 100%);
            border-radius: 6px;
            border-left: 3px solid #06b6d4;
            animation: flowSlideIn 0.4s ease-out;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .api-flow-block:hover {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.12) 0%, rgba(255, 255, 255, 0.06) 100%);
            transform: translateX(3px);
            border-left-color: #10b981;
        }

        @keyframes flowSlideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .api-flow-child {
            padding-left: 15px;
            position: relative;
            margin-top: 3px;
            opacity: 0.9;
            font-size: 10px;
        }

        .api-flow-child::before {
            content: '└──';
            position: absolute;
            left: 0;
            top: 0;
            color: #06b6d4;
            font-weight: bold;
        }

        .java21-pattern-tag {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3);
            animation: tagGlow 2s infinite alternate;
            display: inline-block;
        }

        @keyframes tagGlow {
            0% { box-shadow: 0 2px 6px rgba(16, 185, 129, 0.3); }
            100% { box-shadow: 0 4px 12px rgba(16, 185, 129, 0.5); }
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            animation: statusPulse 2s infinite;
        }

        .status-processing { background: #f59e0b; }
        .status-success { background: #10b981; }
        .status-error { background: #ef4444; }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .pattern-flow-separator {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin: 8px 0;
            position: relative;
        }

        .pattern-flow-separator::before {
            content: '⚡ Pattern Matching Flow ⚡';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: #1e293b;
            padding: 0 8px;
            font-size: 9px;
            color: #f59e0b;
            font-weight: bold;
        }

        /* Improved scrollbar */
        .log-section::-webkit-scrollbar {
            width: 6px;
        }

        .log-section::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 3px;
        }

        .log-section::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            border-radius: 3px;
        }

        .log-section::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #0891b2, #0e7490);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { flex-direction: column; }
            .top-row { flex-direction: column; }
            .instructions-grid { grid-template-columns: 1fr; }
            .right-side { margin-top: 15px; max-height: none; }
            .log-section { height: 250px; }
        }
    </style>
</head>
<body>

<div class="page-wrapper">
    <div class="header">
        <h1>🚀 Java 21 Pattern Matching Demo</h1>
        <p>Simple Interactive Learning with Enhanced Visual Flow Inspector</p>
    </div>

    <div class="container">
        <div class="left-side">
            <div class="top-row">
                <div class="card step1-card">
                    <h3>Step 1: Select Payment Method</h3>
                    <div class="payment-methods">
                        <div class="payment-card selected" data-method="creditcard">
                            <h4>💳 Credit Card</h4>
                            <p>Visa, MC</p>
                        </div>
                        <div class="payment-card" data-method="paypal">
                            <h4>🟦 PayPal</h4>
                            <p>Account</p>
                        </div>
                        <div class="payment-card" data-method="bank">
                            <h4>🏦 Bank</h4>
                            <p>Transfer</p>
                        </div>
                    </div>
                </div>

                <div class="card instructions-card">
                    <h3>📋 Demo Steps</h3>
                    <div class="instructions-grid">
                        <div class="instruction-item">
                            <span class="step-num">1</span>Select method
                        </div>
                        <div class="instruction-item">
                            <span class="step-num">2</span>Choose amount
                        </div>
                        <div class="instruction-item">
                            <span class="step-num">3</span>Process payment
                        </div>
                        <div class="instruction-item">
                            <span class="step-num">4</span>See results
                        </div>
                    </div>
                </div>
            </div>

            <div class="card amount-section">
                <h3>Step 2: Select Amount</h3>
                <p style="margin-bottom: 8px; font-size: 14px;">Amount: <strong id="current-amount">$500</strong></p>
                <div class="amount-buttons">
                    <button class="amount-btn" onclick="setAmount(500)">
                        $500<br><small>Standard</small>
                    </button>
                    <button class="amount-btn" onclick="setAmount(1500)">
                        $1,500<br><small>⚡ Guards</small>
                    </button>
                    <button class="amount-btn" onclick="setAmount(5000)">
                        $5,000<br><small>⚡ High</small>
                    </button>
                </div>
            </div>

            <div class="card">
                <h3>Step 3: Process Payment</h3>
                <button class="process-btn" onclick="processPayment()">
                    🔒 Process with Java 21
                </button>
            </div>

            <div class="card result-card" id="result-section">
                <h3>✅ Result</h3>
                <div id="result-content"></div>
            </div>
        </div>

        <div class="right-side">
            <div class="features-section">
                <h3>🔥 Java 21 Features</h3>
                <div class="feature-item">
                    <strong>Pattern Matching</strong>
                    <code>switch(method) { case "creditcard" -> ... }</code>
                </div>
                <div class="feature-item">
                    <strong>Guard Conditions</strong>
                    <code>when amount > 1000</code>
                </div>
                <div class="feature-item">
                    <strong>Sealed Interfaces</strong>
                    <code>No default case needed</code>
                </div>
            </div>

            <div class="log-header">
                <h3>📊 Visual Flow Inspector</h3>
                <button class="clear-btn" onclick="clearLog()">Clear</button>
            </div>
            <div class="log-section" id="api-log">
                <!-- Clean initial state -->
                <div class="api-flow-block">
                    <div><span class="status-indicator status-success"></span><strong>Simple Pattern Demo Ready!</strong></div>
                    <div class="api-flow-child">🎯 Java 21 Features: Pattern Matching for Switch</div>
                    <div class="api-flow-child">🔥 Language Features: <span class="java21-pattern-tag">Enhanced Switch</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    /**
     * Enhanced Simple Payment Demo JavaScript
     * Location: Embedded in simple-demo.html
     * Purpose: Clean Visual Flow Inspector like Shopping Cart Demo
     */

    // Global Variables
    let currentMethod = 'creditcard';
    let currentAmount = 500;
    let demoStartTime = Date.now();
    let logEntryCount = 0;

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 Enhanced Simple Demo Initializing...');
        initializeDemo();
    });

    /**
     * Initialize the demo with clean state
     */
    function initializeDemo() {
        setupPaymentMethodSelection();
        clearLog(); // Start with clean log

        // Add structured welcome message like shopping cart
        logAPIFlow('Initial Processing', 'Simple Payment Demo Load', 'Frontend');
        logAPIFlow('API Call', 'GET /api/simple-payment/1');
        logAPIFlow('Controller', 'SimplePaymentController.loadDemo');
        logAPIFlow('Service', 'Multiple methods called');
        logAPIFlow('Service Method', 'SimplePaymentService.initializeDemo()', 'Standard Demo API');
        logAPIFlow('Service Method', 'SimplePaymentService.loadPatterns()', 'Standard Demo API');
        logAPIFlow('Operation', 'Initial demo load: pattern matching + guard conditions using loadPatterns()/initializeDemo()');
        logAPIFlow('Feature', 'Sequenced Pattern Matching');

        console.log('✅ Enhanced demo ready');
    }

    /**
     * Setup payment method selection with enhanced feedback
     */
    function setupPaymentMethodSelection() {
        const paymentCards = document.querySelectorAll('.payment-card');

        paymentCards.forEach(card => {
            card.addEventListener('click', function() {
                selectPaymentMethod(this);
            });
        });
    }

    /**
     * Handle payment method selection with Visual Flow Inspector logging
     */
    function selectPaymentMethod(selectedCard) {
        const method = selectedCard.dataset.method;

        // Remove selected from all cards
        document.querySelectorAll('.payment-card').forEach(card => {
            card.classList.remove('selected');
        });

        // Add selected to clicked card
        selectedCard.classList.add('selected');

        // Update global state
        currentMethod = method;

        // Enhanced logging like shopping cart
        logFlowSeparator('Payment Method Selection');
        logFlowEntry('👤 User Action', `Selected ${getMethodName(method)} payment method`);
        logFlowEntry('🎯 Pattern Match', `switch(paymentMethod) → case "${method}"`);
        logFlowEntry('🔥 Java 21 Feature', 'Pattern Matching for Switch', 'java21');
        logFlowEntry('📊 Business Logic', getPatternDescription(method));
    }

    /**
     * Set amount with guard condition analysis
     */
    function setAmount(amount) {
        const previousAmount = currentAmount;
        currentAmount = amount;

        // Update UI
        const amountElement = document.getElementById('current-amount');
        if (amountElement) {
            amountElement.textContent = `$${amount.toLocaleString()}`;
        }

        // Enhanced logging with guard analysis
        logFlowSeparator('Amount Configuration');
        logFlowEntry('💰 Amount Updated', `From $${previousAmount.toLocaleString()} to $${amount.toLocaleString()}`);

        const guardAnalysis = analyzeGuardConditions(currentMethod, amount);
        if (guardAnalysis.triggered) {
            logFlowEntry('⚡ Guard Triggered', `${guardAnalysis.condition} = TRUE`, 'guard');
            logFlowEntry('🔀 Processing Route', guardAnalysis.action, 'warning');
        } else {
            logFlowEntry('✅ Standard Route', 'No guard conditions triggered');
        }
    }

    /**
     * Process payment with comprehensive API logging
     */
    function processPayment() {
        console.log('Processing payment:', { method: currentMethod, amount: currentAmount });

        // Pre-processing logging
        logFlowSeparator('Payment Processing Started');
        logFlowEntry('🚀 API Request', `POST /api/simple-payment/process`);
        logFlowEntry('📋 Payload', `{ method: "${currentMethod}", amount: ${currentAmount} }`);
        logFlowEntry('⏱️ Backend Call', 'Sending request to Spring Boot...');

        const processingStartTime = performance.now();

        const payload = {
            method: currentMethod,
            amount: currentAmount
        };

        fetch('/api/simple-payment/process', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(payload),
        })
        .then(response => {
            const processingTime = Math.round(performance.now() - processingStartTime);

            logFlowEntry('📡 Response Received', `HTTP ${response.status} (${processingTime}ms)`);

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Backend response:', data); // Debug the actual response
            const totalTime = Math.round(performance.now() - processingStartTime);

            // USE ACTUAL BACKEND DATA - NOT HARDCODED
            logAPIFlow('Initial Processing', 'Simple Payment Processing', 'Backend');
            logAPIFlow('API Call', `POST /api/simple-payment/process`);

            // Controller tracking - USE REAL DATA
            if (data.controller_method) {
                logAPIFlow('Controller', data.controller_method);
            }

            // Service layer - USE REAL DATA
            if (data.service_method) {
                logAPIFlow('Service', 'Multiple methods called');
                logAPIFlow('Service Method', data.service_method, 'Pattern Matching API');
            }

            // Java 21 methods from backend - USE REAL DATA
            if (data.java21_methods_used && data.java21_methods_used.length > 0) {
                data.java21_methods_used.forEach(method => {
                    logAPIFlow('Service Method', method, 'Java 21 Feature API');
                });
            }

            // Pattern matching details from backend - USE REAL DATA
            if (data.pattern_matched) {
                logAPIFlow('Service Method', `Pattern: ${data.pattern_matched}`, 'Pattern Detection');
            }

            if (data.guard_condition && data.guard_condition !== 'none') {
                logAPIFlow('Service Method', `Guard: ${data.guard_condition}`, 'Guard Evaluation');
            }

            if (data.processing_action) {
                logAPIFlow('Service Method', `Action: ${data.processing_action}`, 'Processing Logic');
            }

            // Operation from backend - USE REAL DATA
            if (data.pattern_matching_path) {
                logAPIFlow('Operation', data.pattern_matching_path);
            }

            // Business rule from backend - USE REAL DATA
            if (data.business_rule_applied) {
                logAPIFlow('Operation', `Business rule: ${data.business_rule_applied}`);
            }

            // Feature summary from backend - USE REAL DATA
            if (data.java21_features_used && data.java21_features_used.length > 0) {
                logAPIFlow('Feature', `Sequenced Pattern Matching using ${data.java21_features_used.join(', ')}`);
            }

            const result = {
                status: data.status,
                message: data.message,
                pattern: data.java21_feature || 'Pattern Matching',
                color: data.status.includes('APPROVED') ? '#10b981' :
                       data.status.includes('ERROR') ? '#ef4444' : '#f59e0b',
                processingTime: totalTime
            };

            showResult(result);
        })
        .catch(error => {
            console.error('Error:', error);

            // Error logging
            logFlowSeparator('Processing Error');
            logFlowEntry('❌ Backend Error', 'Connection failed to Spring Boot', 'error');
            logFlowEntry('🔧 Check Backend', 'Ensure application running on :8080', 'error');

            const result = {
                status: 'CONNECTION_ERROR',
                message: 'Backend connection failed. Check Spring Boot application.',
                pattern: 'N/A',
                color: '#ef4444',
                processingTime: 0
            };

            showResult(result);
        });
    }

    /**
     * Show result with clean styling
     */
    function showResult(result) {
        const resultSection = document.getElementById('result-section');
        const resultContent = document.getElementById('result-content');

        if (!resultSection || !resultContent) return;

        resultContent.innerHTML = `
            <div style="border-left: 4px solid ${result.color}; padding-left: 15px;">
                <h4 style="color: ${result.color}; margin: 0 0 10px 0;">
                    ${result.status}
                </h4>
                <p style="margin: 0 0 10px 0;">${result.message}</p>
                <div style="background: rgba(0,0,0,0.05); padding: 10px; border-radius: 6px;">
                    <small style="color: #666;">
                        <strong>Java 21:</strong> ${result.pattern}
                        ${result.processingTime > 0 ? `<br><strong>Time:</strong> ${result.processingTime}ms` : ''}
                    </small>
                </div>
            </div>
        `;

        resultSection.style.display = 'block';

        // Final logging
        logFlowEntry('🎉 Demo Complete', `Result: ${result.status}`);
    }

    /**
     * Log API flow exactly like shopping cart - clean structured blocks
     */
    function logAPIFlow(phase, details, context = '') {
        const log = document.getElementById('api-log');
        if (!log) return;

        const entry = document.createElement('div');
        entry.style.marginBottom = '4px';
        entry.style.fontFamily = 'monospace';
        entry.style.fontSize = '12px';
        entry.style.lineHeight = '1.6';
        entry.style.paddingLeft = '8px';

        let content = '';

        switch(phase) {
            case 'Initial Processing':
                content = `<span style="color: #a855f7;">📋</span> <span style="color: #fbbf24; font-weight: bold;">${details}</span> <span style="color: #9ca3af;">(${context})</span>`;
                break;
            case 'API Call':
                content = `<span style="color: #06b6d4;">🌐</span> API Call: <span style="color: #fbbf24;">${details}</span>`;
                break;
            case 'Controller':
                content = `<span style="color: #ef4444;">●</span> Controller: <span style="color: #fbbf24; font-weight: bold;">${details}</span>`;
                break;
            case 'Service':
                content = `<span style="color: #8b5cf6;">●</span> Service: <span style="color: #f3f4f6;">Multiple methods called</span>`;
                break;
            case 'Service Method':
                content = `<span style="color: #6b7280;">&nbsp;&nbsp;&nbsp;&nbsp;└── </span><span style="color: #fbbf24; font-weight: bold;">${details}</span> <span style="color: #6b7280;">– ${context}</span>`;
                break;
            case 'Operation':
                content = `<span style="color: #6b7280;">&nbsp;&nbsp;&nbsp;&nbsp;└── </span><span style="color: #f59e0b;">●</span> Operation: <span style="color: #f3f4f6;">${details}</span>`;
                break;
            case 'Feature':
                content = `<span style="color: #6b7280;">&nbsp;&nbsp;&nbsp;&nbsp;└── </span><span style="color: #10b981;">●</span> Feature: <span style="color: #f3f4f6;">${details}</span>`;
                break;
            default:
                content = `<span style="color: #6b7280;">●</span> <span style="color: #f3f4f6;">${details}</span>`;
        }

        entry.innerHTML = content;
        log.insertBefore(entry, log.firstChild);

        // Limit entries to prevent overflow
        while (log.children.length > 20) {
            log.removeChild(log.lastChild);
        }

        log.scrollTop = 0;
    }

    /**
     * Enhanced logging - backwards compatibility wrapper
     */
    function logFlowEntry(action, details, type = 'info') {
        // Map old format to new API flow format
        switch(type) {
            case 'java21':
                logAPIFlow('Feature', details);
                break;
            case 'guard':
                logAPIFlow('Operation', `Guard condition: ${details}`);
                break;
            default:
                logAPIFlow('Operation', details);
        }
    }

    /**
     * Add flow separator for visual organization
     */
    function logFlowSeparator(title) {
        const log = document.getElementById('api-log');
        if (!log) return;

        const separator = document.createElement('div');
        separator.className = 'pattern-flow-separator';
        separator.innerHTML = `<div style="border-top: 1px solid rgba(255, 255, 255, 0.1); margin: 8px 0; position: relative;"><div style="position: absolute; top: -8px; left: 50%; transform: translateX(-50%); background: #1e293b; padding: 0 8px; font-size: 9px; color: #f59e0b; font-weight: bold;">⚡ ${title} ⚡</div></div>`;

        log.insertBefore(separator, log.firstChild);
    }

    /**
     * Analyze guard conditions for educational feedback
     */
    function analyzeGuardConditions(method, amount) {
        switch(method) {
            case 'creditcard':
                if (amount > 1000) {
                    return {
                        triggered: true,
                        condition: 'amount > $1000',
                        action: 'requiresVerification()',
                        description: 'High-value transaction verification'
                    };
                }
                break;
            case 'bank':
                if (amount >= 5000) {
                    return {
                        triggered: true,
                        condition: 'amount >= $5000',
                        action: 'requiresManagerApproval()',
                        description: 'Large transfer needs approval'
                    };
                }
                break;
        }

        return {
            triggered: false,
            condition: 'none',
            action: 'processStandard()',
            description: 'Standard processing'
        };
    }

    /**
     * Clear the Visual Flow Inspector log
     */
    function clearLog() {
        const log = document.getElementById('api-log');
        if (log) {
            log.innerHTML = '';
            logEntryCount = 0;
            demoStartTime = Date.now();
        }
    }

    /**
     * Get user-friendly method names
     */
    function getMethodName(method) {
        const names = {
            'creditcard': 'Credit Card',
            'paypal': 'PayPal',
            'bank': 'Bank Transfer'
        };
        return names[method] || method;
    }

    /**
     * Get pattern descriptions for education
     */
    function getPatternDescription(method) {
        const patterns = {
            'creditcard': 'CreditCard pattern with amount guards',
            'paypal': 'PayPal pattern with account verification',
            'bank': 'BankTransfer pattern with approval workflow'
        };
        return patterns[method] || 'Unknown pattern';
    }

    // Export for console debugging
    window.DemoControls = {
        setAmount,
        selectPaymentMethodByName: (methodName) => {
            const card = document.querySelector(`[data-method="${methodName}"]`);
            if (card) selectPaymentMethod(card);
        },
        processPayment,
        clearLog,
        currentState: () => ({ method: currentMethod, amount: currentAmount })
    };

    console.log('🚀 Enhanced Simple Demo loaded successfully');
    console.log('🎮 Try: DemoControls.setAmount(1500) or DemoControls.clearLog()');

</script>

</body>
</html>